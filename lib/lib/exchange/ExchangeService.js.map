{"version":3,"sources":["../../../src/lib/exchange/ExchangeService.es6"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;sBAImB,QAAQ;;;;0BACL,aAAa;;;;IAEd,eAAe;AACvB,WADQ,eAAe,CACtB,QAAQ,EAAE,UAAU,EAAE,SAAS,EAAE,OAAO,EAAE;0BADnC,eAAe;;AAEhC,+BAFiB,eAAe,6CAE1B,IAAI,oBAAO,YAAY,EAAE,EAAE,IAAI,oBAAO,YAAY,EAAE,EAAE,OAAO,EAAE;AACrE,QAAI,CAAC,cAAc,GAAG,UAAU,CAAC;AACjC,QAAI,CAAC,aAAa,GAAG,SAAS,CAAC;AAC/B,QAAI,CAAC,SAAS,GAAG,QAAQ,CAAC;AAC1B,WAAO,IAAI,CAAC,IAAI,EAAE,CAAC;GACpB;;YAPkB,eAAe;;eAAf,eAAe;;WAS9B,gBAAG;;;AACL,UAAI,CAAC,aAAa,CAAC,EAAE,CAAC,gBAAgB,EAAE,UAAC,QAAQ,EAAI;;AAEnD,YAAI,eAAe,GAAG,IAAI,oBAAO,YAAY,EAAE,CAAC;AAChD,YAAI,cAAc,GAAG,IAAI,oBAAO,YAAY,EAAE,CAAC;AAC/C,cAAK,aAAa,CAAC,EAAE,CAAC,QAAQ,EAAE,UAAC,OAAO,EAAK;AAC3C,wBAAc,CAAC,IAAI,CAAC,OAAO,CAAC,GAAG,EAAE,OAAO,CAAC,KAAK,CAAC,CAAC;SACjD,CAAC,CAAC;;AAEH,uBAAe,CAAC,EAAE,CAAC,MAAM,EAAE,UAAC,OAAO,EAAK;AACtC,gBAAK,cAAc,CAAC,IAAI,CAAC,MAAM,EAAE,QAAQ,EAAE,OAAO,CAAC,CAAC;SACrD,CAAC,CAAC;;AAEH,YAAI,QAAQ,GAAG,IAAI,MAAK,SAAS,CAAC,eAAe,EAAE,cAAc,EAAE;AACjE,kBAAQ,EAAE,QAAQ;AAClB,cAAI,EAAE,MAAK,IAAI;SAChB,CAAC,CAAC;;AAEH,cAAK,UAAU,CAAC,IAAI,CAAC,SAAS,EAAE,QAAQ,CAAC,CAAC;;AAE1C,gBAAQ,CAAC,WAAW,GAAG,IAAI,CAAC;;AAE5B,cAAK,aAAa,CAAC,EAAE,CAAC,mBAAmB,EAAE,UAAC,QAAQ,EAAK;AACvD,wBAAc,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;AAClC,kBAAQ,GAAG,IAAI,CAAC;SACjB,CAAC,CAAC;;AAEH,cAAK,aAAa,CAAC,EAAE,CAAC,YAAY,EAAE,UAAC,QAAQ,EAAK;AAChD,wBAAc,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;SACnC,CAAC,CAAC;OACJ,CAAC,CAAC;KACJ;;;;;;;;;WAOC,YAAC,KAAK,EAAE,QAAQ,EAAE;AAClB,UAAI,CAAC,UAAU,CAAC,WAAW,CAAC,KAAK,EAAE,QAAQ,CAAC,CAAC;KAC9C;;;;;;;;;WAOG,cAAC,KAAK,EAAW;wCAAN,IAAI;AAAJ,YAAI;;;AACjB,UAAI,CAAC,IAAI,CAAC,WAAW,EAAE;AACrB,eAAO;OACR;;kDA3DgB,eAAe,uCA6D6B,IAAI;;UAAlD,OAAO,cAAhB,OAAO;UAAqB,QAAQ,cAAlB,QAAQ;;AAEhC,UAAI,CAAC,WAAW,CAAC,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,SAAS,CAAC,EAAE,GAAG,EAAE,KAAK,EAAE,KAAK,EAAE,OAAO,EAAE,CAAC,CAAC,CAAC;;AAE9E,UAAI,QAAQ,EAAE;AACZ,gBAAQ,EAAE,CAAC;OACZ;KACF;;;SApEkB,eAAe;;;qBAAf,eAAe","file":"ExchangeService.js","sourcesContent":["/**\n * Created by michaelsilvestre on 14/06/15\n */\n\nimport events from \"events\"\nimport Exchanger from './Exchanger'\n\nexport default class ExchangeService extends Exchanger {\n  constructor(Exchange, messageOut, messageIn, options) {\n    super(new events.EventEmitter(), new events.EventEmitter(), options);\n    this._messageOutTmp = messageOut;\n    this._messageInTmp = messageIn;\n    this._Exchange = Exchange;\n    return this.init();\n  }\n\n  init() {\n    this._messageInTmp.on('device_connect', (deviceId)=> {\n\n      let localMessageOut = new events.EventEmitter();\n      let localMessageIn = new events.EventEmitter();\n      this._messageInTmp.on(deviceId, (message) => {\n        localMessageIn.emit(message.key, message.value);\n      });\n\n      localMessageOut.on('send', (message) => {\n        this._messageOutTmp.emit('send', deviceId, message);\n      });\n\n      let exchange = new this._Exchange(localMessageOut, localMessageIn, {\n        deviceId: deviceId,\n        role: this.role\n      });\n\n      this._messageIn.emit('connect', exchange);\n\n      exchange.isConnected = true;\n\n      this._messageInTmp.on('device_disconnect', (deviceId) => {\n        localMessageIn.emit('disconnect');\n        exchange = null;\n      });\n\n      this._messageInTmp.on('disconnect', (deviceId) => {\n        localMessageIn.emit('disconnect');\n      });\n    });\n  }\n\n  /**\n   *\n   * @param {String} event\n   * @param {Function} callback\n   */\n  on(event, callback) {\n    this._messageIn.addListener(event, callback);\n  }\n\n  /**\n   *\n   * @param {String} event\n   * @param {Arguments} args\n   */\n  emit(event, ...args) {\n    if (!this.isConnected) {\n      return;\n    }\n\n    let { message: message, callback: callback } = super.emit(...args);\n\n    this._messageOut.emit('send', JSON.stringify({ key: event, value: message }));\n\n    if (callback) {\n      callback();\n    }\n  }\n}\n\n"]}