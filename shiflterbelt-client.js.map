{"version":3,"sources":["shiflterbelt-client.es6"],"names":[],"mappings":"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","file":"shiflterbelt-client.js","sourcesContent":["/**\n * Created by michaelsilvestre on 25/04/15\n */\n\nimport events from \"events\"\nimport socketClient from 'socket.io-client'\nimport validUrl from 'valid-url'\nimport getmac from 'getmac'\n\nfunction validateOption(options) {\n    let extras = {\n        mac_address: (value) => {\n            return getmac.isMac(value);\n        }\n    };\n\n    let optionSchema = {\n        url: { type: \"string\" },\n        applicationId: { type: \"number\" },\n        key: { type: \"string\", len: 40 },\n        password: { type : \"string\", len: 80 },\n        macAddress: { type: \"string\", len: 17, extra: [\"mac_address\"] }\n    };\n\n    let valide = (key, value) => {\n        if (!optionSchema.hasOwnProperty(key)) {\n            return new Error(`The option: ${key}, not exist`);\n        }\n        if (typeof(value) !== optionSchema[key].type) {\n            return new Error(`The type of: ${key}, is not ${optionSchema[key].type}`);\n        }\n        if (optionSchema[key].hasOwnProperty('len') && value.length !== optionSchema[key].len) {\n            return new Error(`The length of: ${key}, is not equal to ${optionSchema[key].len}`);\n        }\n        if (optionSchema[key].hasOwnProperty('extras')) {\n            let result = optionSchema[key]['extras'].filter((extra) => {\n                return !extras[extra](value)\n            });\n            if (result>0) {\n                return new Error(`There is an error in the extras values ${result}`);\n            }\n        }\n        return value;\n    };\n\n    let result = {};\n    if (typeof(options) === 'string') {\n        result = { err: null, result: { url: options, options: {} } };\n    }\n\n    if (typeof(options) === 'object') {\n        let url = \"\";\n        let option = {};\n\n        if (!options.hasOwnProperty('url')) {\n            return new Error('No url found');\n        }\n        let optionValues = Object.keys(options).map((value) => {\n                return valide(value, options[value]);\n            });\n        let optionValidate = optionValues.filter((value) => {\n                return (value instanceof Error) || value === \"\"\n            });\n        if (optionValidate.length > 0) {\n            let errors = optionValidate.map((value) => { return value.message }).join(', ');\n            return { err: new Error(`Error in options: ${errors}`), result: null };\n        }\n        url = options.url;\n        delete options.url;\n        option = Object.keys(options).map((value) => {\n            return `${value}=${options[value]}`;\n        }).join('&');\n\n        result = { err: null, result: { url: url, options: option, raw: options } };\n    }\n\n    if (!validUrl.is_uri(result.result.url)) {\n        return { err: new Error(`The URL: ${result.result.url}, is not valid`), result: null };\n    }\n\n    return result;\n\n}\n\nexport default class ShifterbeltClient {\n    constructor(options) {\n        this._obj1 = new events.EventEmitter();\n        this._obj2 = new events.EventEmitter();\n        this._connected = false;\n        getmac.getMac((err, macAddress) => {\n            options.macAddress = macAddress;\n            this.init(options);\n        });\n    }\n\n    init(options) {\n\n        let valide = validateOption(options);\n\n        if (valide.err) {\n            return console.log(valide.err.message);\n        }\n\n        this._socket = socketClient(valide.result.url, { query: valide.result.options });\n\n        this._socket.on('connect', () => {\n            //this._obj1.emit('connect');\n            this._socket.emit('authenticate', JSON.stringify(valide.result.raw));\n            this._socket.on('authenticated', () => {\n                this._connected = true;\n                this._socket.on('message', (message) => {\n                    let chunk = {};\n                    if (message.hasOwnProperty('content')) {\n                        let result = JSON.parse(message.content.toString());\n                        chunk[result['key']] = JSON.parse(result['value']);\n                    } else {\n                        chunk = message;\n                    }\n                    var keys = Object.keys(chunk);\n                    if (keys.length !== 1) {\n                        return;\n                    }\n                    this._obj1.emit(keys[0], chunk[keys[0]]);\n                });\n                this._obj2.addListener('send', (data) => {\n                    /*\n                    let jsonObj = JSON.parse(data);\n\n                    if (!jsonObj.value) {\n                        this._socket.emit(jsonObj.key);\n                        return;\n                    }\n                    this._socket.emit(jsonObj.key, jsonObj.value);\n                    */\n                    this._socket.emit('message', data);\n                });\n                this._obj1.emit('connect');\n            });\n        });\n\n        this._socket.on('disconnect', () => {\n            this._connected = false;\n        });\n    }\n\n\n    on(event, callback) {\n        this._obj1.addListener(event, callback);\n    }\n\n    get error() {\n        return this._error;\n    }\n\n    emit(event, ...args) {\n        if (!this._connected) {\n            return;\n        }\n        let message;\n        let callback = null;\n        if (args.length === 0) {\n            message = null;\n        }\n        if (args.length === 1) {\n            if (\"function\" === typeof args[0]) {\n                callback = args[0];\n            } else {\n                message = args[0];\n            }\n\n        }\n        if (args.length > 1) {\n            let sliceTotal = args.length;\n            if (\"function\" === typeof args.length) {\n                sliceTotal = sliceTotal - 1;\n                callback = args[sliceTotal-1];\n            }\n            message = args.slice(0, sliceTotal).join(\" \");\n        }\n        this._obj2.emit('send', JSON.stringify({ key: event, value: JSON.stringify(message) }));\n\n        if (callback) {\n            callback();\n        }\n    }\n\n}"]}