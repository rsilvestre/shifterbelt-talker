{"version":3,"sources":["shiflterbelt-client.es6"],"names":[],"mappings":"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","file":"shiflterbelt-client.js","sourcesContent":["/**\n * Created by michaelsilvestre on 25/04/15\n */\n\nimport events from \"events\"\nimport socketClient from 'socket.io-client'\nimport getmac from 'getmac'\nimport ValidateOptions from './lib/ValidateOptions.js'\nimport AnalyseMessage from './lib/AnalyseMessage.js'\nimport { _extend } from 'util'\n\nclass Exchange {\n  constructor(messageOut, messageIn) {\n    this._messageOut = messageOut;\n    this._messageIn = messageIn;\n  }\n\n  /**\n   *\n   * @param {String} event\n   * @param {Function} callback\n   */\n  on(event, callback) {\n    this._messageIn.addListener(event, callback);\n  }\n\n  /**\n   *\n   * @param {String} event\n   * @param {Arguments} args\n   */\n  emit(event, ...args) {\n    if (!this._connected) {\n      return;\n    }\n    let message;\n    let callback = null;\n    if (args.length === 0) {\n      message = null;\n    }\n    if (args.length === 1) {\n      if (\"function\" === typeof args[0]) {\n        callback = args[0];\n      } else {\n        message = args[0];\n      }\n\n    }\n    if (args.length > 1) {\n      let sliceTotal = args.length;\n      if (\"function\" === typeof args.length) {\n        sliceTotal = sliceTotal - 1;\n        callback = args[sliceTotal - 1];\n      }\n      message = args.slice(0, sliceTotal).join(\" \");\n    }\n    this._messageOut.emit('send', JSON.stringify({ key: event, value: message }));\n\n    if (callback) {\n      callback();\n    }\n  }\n}\n\nexport default class ShifterbeltClient {\n  /**\n   *\n   * @param {{}} options\n   */\n  constructor(options) {\n    this._messageInternalOut = new events.EventEmitter();\n    this._messageOut = new events.EventEmitter();\n    this._messageIn = new events.EventEmitter();\n    this._connected = false;\n\n    // Setted dynamically\n    this._masters = {};\n    this._managers = {};\n    this._slaves = {};\n\n    options = _extend({url: \"http://www.shifterbelt.com/ns\"}, options);\n\n    getmac.getMac((err, macAddress) => {\n      options.macAddress = options.macAddress || macAddress; // TODO : Remove: \"options.macAddress ||\"\n      this.init(options);\n    });\n  }\n\n  /**\n   *\n   * @param {{}} options\n   */\n  init(options) {\n\n    let valide = (new ValidateOptions(options)).execute();\n\n    if (valide.err) {\n      return console.log(valide.err.message);\n    }\n\n    this._socket = socketClient(valide.result.url, { query: valide.result.options });\n\n    this._socket.on('connect', () => {\n      this._socket.on('error_system', (message) => {\n        this._messageInternalOut.emit('error_system', message);\n      });\n\n      this._socket.emit('authenticate', JSON.stringify(valide.result.raw));\n\n      this._socket.on('authenticated', () => {\n        this._connected = true;\n\n        this._authenticated();\n      });\n    });\n\n    this._socket.on('disconnect', () => {\n      this._connected = false;\n    });\n  }\n\n  /**\n   *\n   * @private\n   */\n  _authenticated() {\n    this._socket.on('message', (message) => {\n      this._internalOnMessage(message);\n    });\n\n    this._socket.on('service', (message) => {\n      this._internelOnService(message);\n    });\n\n    this._messageOut.addListener('send', (data) => {\n      this._socket.emit('message', data);\n    });\n\n    this._messageInternalOut.emit('connect', new Exchange(this._messageOut, this._messageIn));\n  }\n\n  /**\n   *\n   * @param {Object} message\n   * @private\n   */\n  _internalOnMessage(message) {\n    let chunk = {};\n\n    if (message.hasOwnProperty('content')) {\n      let result = JSON.parse(message.content.toString());\n\n      chunk[result['key']] = result['value'];\n    } else {\n      chunk = message;\n    }\n    var keys = Object.keys(chunk);\n    if (keys.length !== 1) {\n      return;\n    }\n    this._messageIn.emit(keys[0], chunk[keys[0]]);\n  }\n\n  /**\n   *\n   * @param {{}} message\n   * @private\n   */\n  _internelOnService(message) {\n    (new AnalyseMessage(message, this)).init();\n  }\n\n  /**\n   *\n   * @param {String} event\n   * @param {Function} callback\n   */\n  on(event, callback) {\n    this._messageInternalOut.addListener(event, callback);\n  }\n\n}"]}